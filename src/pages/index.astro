---
import { Card, CardGrid } from '@astrojs/starlight/components';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import Footer from '../components/Footer.astro';
import fs from 'node:fs';
import path from 'node:path';

// Read model data from JSON (generated by sync_models.py via GitHub Actions)
let topModels: { display_name: string; author: string; likes: string; downloads: string; slug: string; pipeline_tag: string }[] = [];
try {
  const modelsPath = path.resolve(process.cwd(), 'data/models.json');
  const modelsData = JSON.parse(fs.readFileSync(modelsPath, 'utf-8'));
  // Sort by likes (descending) and take top 6
  topModels = modelsData
    .sort((a: any, b: any) => {
      const likesA = parseInt(String(a.likes).replace(/[^\d]/g, '')) || 0;
      const likesB = parseInt(String(b.likes).replace(/[^\d]/g, '')) || 0;
      return likesB - likesA;
    })
    .slice(0, 6);
} catch (e) {
  // If file not found (e.g., first build), use empty array
  console.warn('models.json not found, using empty model list for homepage.');
}

const frontmatter = {
  title: 'SLM Hub',
  description: 'Developer-centric documentation for Small Language Models (SLMs). Learn, choose, and deploy locally or at the edge.',
  template: 'splash',
  prev: false,
  next: false,
};
---

<StarlightPage frontmatter={frontmatter} headings={[]}>
  <div class="sl-container homepage">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">
          Small Models. <span class="gradient-text">Big Impact.</span>
        </h1>
        <p class="hero-tagline">
          The open-source learning platform for Small Language Models. 
          <strong>100% executable</strong> ‚Äî every guide runs in Google Colab.
        </p>
        <div class="hero-actions">
          <a href="/slmhub/docs/start-here/" class="sl-link-button" data-variant="primary">
            <span>Start Learning ‚Üí</span>
          </a>
          <a href="/slmhub/docs/models/generated/directory/" class="sl-link-button" data-variant="minimal">
            <span>Browse Models</span>
          </a>
        </div>
      </div>
      <div class="hero-image">
        <img src="/slmhub/logo.svg" alt="SLM Hub Logo" />
      </div>
    </section>

    <!-- Course Curriculum Section -->
    <section class="course-section">
      <h2 class="section-title">üó∫Ô∏è Your Learning Path</h2>
      <p class="section-subtitle">A structured curriculum to take you from zero to deploying your own SLM.</p>

      <div class="learning-path">
        <div class="path-card">
          <div class="path-number">01</div>
          <h3>Start Here</h3>
          <p>What are SLMs? Environment setup. Your first 5-line inference.</p>
          <a href="/slmhub/docs/start-here/">Begin ‚Üí</a>
        </div>
        <div class="path-card">
          <div class="path-number">02</div>
          <h3>Fundamentals</h3>
          <p>Tokenization, Architecture, Quantization, Embeddings.</p>
          <a href="/slmhub/docs/learn/fundamentals/">Explore ‚Üí</a>
        </div>
        <div class="path-card">
          <div class="path-number">03</div>
          <h3>Concepts</h3>
          <p>RAG, Function Calling, Agents, and Dataset Curation.</p>
          <a href="/slmhub/docs/learn/concepts/rag/">Deep Dive ‚Üí</a>
        </div>
        <div class="path-card">
          <div class="path-number">04</div>
          <h3>Deploy</h3>
          <p>Run models locally with Ollama, vLLM, llama.cpp, or in-browser.</p>
          <a href="/slmhub/docs/deploy/quickstarts/ollama/">Deploy ‚Üí</a>
        </div>
      </div>
    </section>

    <!-- Foundations Section -->
    <section class="foundations-section">
      <h2 class="section-title">üìö Foundations</h2>
      <p class="section-subtitle">Master the core building blocks of every language model.</p>
      <CardGrid>
        <Card title="Tokenization" class="foundation-card">
          <p>How text becomes numbers. BPE, subword, and byte-level tokenizers.</p>
          <a href="/slmhub/docs/learn/fundamentals/tokenization/">Learn ‚Üí</a>
        </Card>
        <Card title="Model Architecture" class="foundation-card">
          <p>Transformers, attention, layers, and what makes SLMs "small".</p>
          <a href="/slmhub/docs/learn/fundamentals/architecture/">Learn ‚Üí</a>
        </Card>
        <Card title="Quantization" class="foundation-card">
          <p>4-bit, 8-bit, GPTQ, GGUF. Run big models on small hardware.</p>
          <a href="/slmhub/docs/learn/fundamentals/quantization/">Learn ‚Üí</a>
        </Card>
        <Card title="Fine-Tuning" class="foundation-card">
          <p>LoRA, QLoRA, and PEFT. Customize models for your domain.</p>
          <a href="/slmhub/docs/learn/fundamentals/fine-tuning/">Learn ‚Üí</a>
        </Card>
      </CardGrid>
    </section>

    <!-- Top Models Section -->
    <section class="models-section">
      <h2 class="section-title">üèÜ Top Models</h2>
      <p class="section-subtitle">Automatically synced from Hugging Face, sorted by community love.</p>
      
      {topModels.length > 0 ? (
        <div class="models-table-wrapper">
          <table class="models-table">
            <thead>
              <tr>
                <th>Model</th>
                <th>Author</th>
                <th>Task</th>
                <th>‚ù§Ô∏è Likes</th>
                <th>‚¨áÔ∏è Downloads</th>
              </tr>
            </thead>
            <tbody>
              {topModels.map((m) => (
                <tr>
                  <td><a href={`/slmhub/docs/models/generated/${m.slug}/`}>{m.display_name}</a></td>
                  <td>{m.author}</td>
                  <td>{m.pipeline_tag}</td>
                  <td>{m.likes}</td>
                  <td>{m.downloads}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      ) : (
        <p class="no-data">Model data syncs daily via GitHub Actions. Check back soon!</p>
      )}
      <div class="cta-link">
        <a href="/slmhub/docs/models/generated/directory/">View All Models ‚Üí</a>
      </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
      <div class="newsletter-content">
        <h2>üì¨ Stay Updated</h2>
        <p>Get the latest SLM news, tutorials, and model releases. No spam, just value.</p>
        <form class="newsletter-form" action="https://buttondown.email/api/emails/embed-subscribe/slmhub" method="post" target="_blank">
          <input type="email" name="email" placeholder="your@email.com" required />
          <button type="submit">Subscribe</button>
        </form>
        <small>Powered by Buttondown. Unsubscribe anytime.</small>
      </div>
    </section>

  </div>
</StarlightPage>

<style>
  /* Base Section Styles */
  .homepage {
    padding-bottom: 4rem;
  }

  .section-title {
    font-size: 2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 0.5rem;
    font-family: 'Space Grotesk', system-ui, sans-serif;
  }

  .section-subtitle {
    text-align: center;
    color: var(--sl-color-gray-3);
    margin-bottom: 3rem;
    font-size: 1.1rem;
  }

  /* Hero */
  .hero {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: center;
    padding: 4rem 0;
    min-height: 55vh;
  }
  .hero-title {
    font-size: 3.5rem;
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 1.5rem;
    font-family: 'Space Grotesk', system-ui, sans-serif;
  }
  .hero-tagline {
    font-size: 1.2rem;
    margin-bottom: 2rem;
    line-height: 1.6;
    color: var(--sl-color-gray-2);
  }
  .hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .hero-image img {
    max-width: 300px;
    width: 100%;
    height: auto;
    filter: drop-shadow(0 15px 30px rgba(255, 107, 53, 0.2));
  }

  /* Learning Path */
  .course-section {
    padding: 4rem 0;
    border-top: 1px solid var(--sl-color-hairline);
  }
  .learning-path {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
  }
  .path-card {
    background: var(--sl-color-bg-nav);
    border: 1px solid var(--sl-color-hairline);
    border-radius: 1rem;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .path-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }
  .path-number {
    font-size: 3rem;
    font-weight: 800;
    color: var(--sl-color-accent);
    opacity: 0.15;
    position: absolute;
    top: -0.5rem;
    right: 0.5rem;
    font-family: 'Space Grotesk', sans-serif;
  }
  .path-card h3 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  .path-card p {
    font-size: 0.9rem;
    color: var(--sl-color-gray-3);
    margin-bottom: 1rem;
  }
  .path-card a {
    font-weight: 600;
    color: var(--sl-color-text-accent);
    text-decoration: none;
  }

  /* Foundations */
  .foundations-section {
    padding: 4rem 0;
    border-top: 1px solid var(--sl-color-hairline);
  }

  /* Models Table */
  .models-section {
    padding: 4rem 0;
    border-top: 1px solid var(--sl-color-hairline);
  }
  .models-table-wrapper {
    overflow-x: auto;
  }
  .models-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }
  .models-table th, .models-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--sl-color-hairline);
  }
  .models-table th {
    background: var(--sl-color-bg-nav);
    font-weight: 600;
    color: var(--sl-color-gray-2);
  }
  .models-table td a {
    color: var(--sl-color-text-accent);
    font-weight: 500;
    text-decoration: none;
  }
  .models-table td a:hover {
    text-decoration: underline;
  }
  .cta-link {
    text-align: center;
    margin-top: 2rem;
  }
  .cta-link a {
    color: var(--sl-color-text-accent);
    font-weight: 600;
    text-decoration: none;
  }
  .no-data {
    text-align: center;
    color: var(--sl-color-gray-4);
    font-style: italic;
  }

  /* Newsletter */
  .newsletter-section {
    padding: 4rem 0;
    border-top: 1px solid var(--sl-color-hairline);
  }
  .newsletter-content {
    max-width: 500px;
    margin: 0 auto;
    text-align: center;
  }
  .newsletter-content h2 {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }
  .newsletter-content p {
    color: var(--sl-color-gray-3);
    margin-bottom: 1.5rem;
  }
  .newsletter-form {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  .newsletter-form input[type="email"] {
    padding: 0.75rem 1rem;
    border: 1px solid var(--sl-color-hairline);
    border-radius: 0.5rem;
    font-size: 1rem;
    background: var(--sl-color-bg);
    color: var(--sl-color-text);
    min-width: 200px;
  }
  .newsletter-form button {
    padding: 0.75rem 1.5rem;
    background: var(--sl-color-accent);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }
  .newsletter-form button:hover {
    background: var(--sl-color-accent-high);
  }
  .newsletter-content small {
    display: block;
    margin-top: 1rem;
    color: var(--sl-color-gray-5);
    font-size: 0.8rem;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hero {
      grid-template-columns: 1fr;
      text-align: center;
    }
    .hero-title {
      font-size: 2.5rem;
    }
    .hero-actions {
      justify-content: center;
    }
  }
</style>
